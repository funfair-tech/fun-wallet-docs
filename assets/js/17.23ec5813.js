(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{394:function(e,t,a){"use strict";a.r(t);var o=a(22),n=Object(o.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"leader-and-follower-communication"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#leader-and-follower-communication"}},[e._v("#")]),e._v(" Leader and Follower Communication")]),e._v(" "),a("h2",{attrs:{id:"introduction"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#introduction"}},[e._v("#")]),e._v(" Introduction")]),e._v(" "),a("p",[e._v("Since the Wallet can't trust the dApp hosting the client, it can't pass sensitive data through to the SDK, because that's hosted on the dApp and would mean the dApp could get access to that sensitive data (e.g. the private key), which would be an unacceptable security compromise. The 'Leader and Follower' solution allows communication between the "),a("code",[e._v("leader")]),e._v(" and the "),a("code",[e._v("follower")]),e._v(" without the dApp being able to intercept the data, allowing the Wallet to have two instances of itself running for reasons described below.")]),e._v(" "),a("p",[e._v("If iframes are removed from the DOM, it kills the instance and when added back to the DOM it reloads itself. Also, if you move an iframe using JavaScript it also reloads itself - so there is no such thing as "),a("code",[e._v("magic iframes")]),e._v(".")]),e._v(" "),a("p",[e._v("As the Wallet needs to be authenticated and then never reloaded due to it holding the user's private key in memory, this causes a bit of a problem. Front-end apps of today use awesome frameworks like Angular and React, and developers want to take advantage of lazy loading and other solid approaches. If you just had one instance which never got removed from the DOM it would only work on a very basic Web app, hence where the "),a("code",[e._v("leader")]),e._v(" and "),a("code",[e._v("follower")]),e._v(" come in.")]),e._v(" "),a("h2",{attrs:{id:"what-is-a-leader-instance"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-is-a-leader-instance"}},[e._v("#")]),e._v(" What is a Leader Instance?")]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("leader")]),e._v(" is the authenticated instance which never gets removed from the DOM or moved. The "),a("code",[e._v("leader")]),e._v(" is the communication window which speaks to the SDK. This is in charge of spawning up a new "),a("code",[e._v("follower")]),e._v(" instance and runs the show. Your dApp will only ever speak to the leader when it needs to perform SDK calls. All event listeners and messages will be sent to the parent from the "),a("code",[e._v("leader")]),e._v(". You "),a("strong",[e._v("MUST")]),e._v(" only ever have "),a("code",[e._v("1")]),e._v(" leader - the SDK will throw errors if you ever have more then one.")]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("leader")]),e._v(" instance will be in an "),a("code",[e._v("iframe")]),e._v(" hidden away in the start of the "),a("code",[e._v("<body>")]),e._v(" and invisible. Once the user has logged in, the "),a("a",{attrs:{href:"#authenticationcompleted"}},[a("code",[e._v("authenticationCompleted")])]),e._v(" event is fired and the leader is completely authenticated. Any sensitive data passed between the leader and the follower is RSA-encrypted so nobody can decrypt it, "),a("em",[e._v("including")]),e._v(" the dApp. The leader will keep everything in sync going forward (like nonces, blocks etc).")]),e._v(" "),a("p",[e._v("You should never use the "),a("code",[e._v("leader")]),e._v(" instance to show the standard UI as it doesn't route to certain views - it's mainly used for the communication, approval modals, KYC process and player protection. If you want to show any other Wallet UI please use a "),a("code",[e._v("follower")]),e._v(" instance to do that.")]),e._v(" "),a("h2",{attrs:{id:"what-is-a-follower"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-is-a-follower"}},[e._v("#")]),e._v(" What is a Follower?")]),e._v(" "),a("p",[e._v("The follower is an instance you can spawn and destroy whenever you want. This is what you would use to show content on the UI for the Wallet. You can only ever have "),a("code",[e._v("1 leader")]),e._v(" and "),a("code",[e._v("1 follower")]),e._v(", due to synchronisation being essential. This is a fixed limit.")]),e._v(" "),a("p",[e._v("You must only ever spawn a follower when the "),a("a",{attrs:{href:"#authenticationcompleted"}},[a("code",[e._v("authenticationCompleted")])]),e._v(" event has fired and you know the leader instance is authenticated. You can also check this by using the "),a("a",{attrs:{href:"#isauthenticated"}},[a("code",[e._v("isAuthenticated")])]),e._v(" SDK method. This again is all shown in the Wallet integration test app.")]),e._v(" "),a("h2",{attrs:{id:"secure-communication-between-the-leader-and-follower"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#secure-communication-between-the-leader-and-follower"}},[e._v("#")]),e._v(" Secure Communication Between the Leader and Follower")]),e._v(" "),a("p",[e._v("The leader and the follower communicate using the "),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Broadcast_Channel_API",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("Broadcast Channel Api")]),a("OutboundLink")],1),e._v(", or via cookies. Safari and Edge do not support the native "),a("code",[e._v("Broadcast Channel API")]),e._v(" so they communicate by saving and reading cookies.")]),e._v(" "),a("img",{attrs:{src:e.$withBase("/leader-follower-authentication-flow.png")}}),e._v(" "),a("p",[e._v("As you can see in the above flow, all data passed between the instances is encrypted, meaning if someone did get to that data it's useless without the RSA private key. This private key is never exposed and is held in memory within the instances.")]),e._v(" "),a("h2",{attrs:{id:"how-is-the-leader-and-follower-communication-secure"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how-is-the-leader-and-follower-communication-secure"}},[e._v("#")]),e._v(" How is the Leader and Follower Communication Secure?")]),e._v(" "),a("p",[e._v("ðŸ’¡ Every message between leader > follower and follower > leader is encrypted.")]),e._v(" "),a("p",[e._v("ðŸ’¡ Even if the dApp could snoop (which it can't), the messages will be a blob of data without the RSA private key which is held in the instance's memory, which means it's a useless blob of data.\n"),a("br"),e._v("\nÂ Â Â Â Â Â  ðŸ’¡ A dApp can't get to that as it's protected by cross-site scripting and standard Internet security.\n"),a("br")]),e._v(" "),a("p",[e._v("ðŸ’¡ Broadcast API is something supported in most browsers, but not in Safari or Edge.\n"),a("br"),e._v("\nÂ Â Â Â Â Â  ðŸ’¡ This can only broadcast to its own domain. For example, "),a("code",[e._v("wallet.funfair.io")]),e._v(" can only speak to "),a("code",[e._v("wallet.funfair.io")]),e._v(", so itâ€™s never exposed to anyone else.")]),e._v(" "),a("p",[e._v("ðŸ’¡ Due to differences within Safari and Edge, we had to write our own broadcast logic for those browsers, which uses cookies to read and write values to each instance, again protected by the domain.")]),e._v(" "),a("p",[e._v("ðŸ’¡ As client-side code is holding the private key in memory, there's no physical trace of it anywhere after you refresh. The encrypted session data may remain, but is useless without all the other encrypted data as it's double encrypted. This is also removed when you close the tab.")])])}),[],!1,null,null,null);t.default=n.exports}}]);